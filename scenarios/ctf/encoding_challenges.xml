<?xml version="1.0"?>

<scenario xmlns="http://www.github/cliffe/SecGen/scenario"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://www.github/cliffe/SecGen/scenario">

  <!--TODO-->
  <name>Encoding Challenges</name>
  <author>Thomas Shaw</author>
  <description>Single system narrative-based CTF challenge.</description>

  <type>ctf</type>
  <type>attack-ctf</type>
  <type>web-hints</type>
  <difficulty>intermediate</difficulty>
  <!--/TODO-->

  <system>
    <system_name>system</system_name>
    <base platform="linux" type="desktop" distro="Stretch"/>

    <input into_datastore="IP_addresses">
      <value>172.16.0.12</value>
    </input>

    <!-- 6x encoding challenges per challenger -->
    <!-- 1: random encoder -->
    <!-- 2: random encoder -->
    <!-- 3: random encoder -->
    <!-- 4: random encoder -->
    <!-- 5: random encoder double encoded -->
    <!-- 6: random high difficulty encoder -->

    <!-- 9x hash challenges per challenger -->
    <!-- 7:  Unsalted dictionary word -->
    <!-- 8:  Unsalted password -->
    <!-- 9:  Dictionary word - dictionary salt - salt provided -->
    <!-- 10: Dictionary word - dictionary salt - salt not provided -->
    <!-- 11: Random password - dictionary salt - salt provided -->
    <!-- 12: Random password - dictionary salt - salt not provided -->
    <!-- 13: Number - unsalted -->
    <!-- 14: Dictionary word - numerical salt - salt provided -->
    <!-- 15: Dictionary word - numerical salt - salt not provided -->


    <!--Datastore contains all challenges except #6 -->

    <input into_datastore="challenges" unique_module_list="unique_encoders">
      <!-- 1: random encoder -->
      <encoder type="ascii_reversible">
        <input into="strings_to_encode">
          <generator type="flag_generator"/>
        </input>
      </encoder>

      <!-- 2: random encoder -->
      <encoder type="alpha_reversible">
        <input into="strings_to_encode">
          <generator type="flag_generator"/>
        </input>
      </encoder>

      <!-- 3: random encoder -->
      <encoder type="ascii_reversible">
        <input into="strings_to_encode">
          <generator type="flag_generator"/>
        </input>
      </encoder>

      <!-- 4: random encoder -->
      <encoder type="ascii_reversible">
        <input into="strings_to_encode">
          <generator type="flag_generator"/>
        </input>
      </encoder>

      <!-- 5: random encoder double encoded -->
      <encoder type="ascii_reversible">
        <input into="strings_to_encode">
          <encoder type="ascii_reversible">
            <input into="strings_to_encode">
              <generator type="flag_generator"/>
            </input>
          </encoder>
        </input>
      </encoder>

      <!-- 7: Unsalted dictionary word -->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_word_generator"/>
        </input>
      </encoder>
      <!-- 8: Unsalted password -->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="password_generator"/>
        </input>
      </encoder>

      <!-- 9: Dictionary word - dictionary salt - salt provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_word_generator"/>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>true</value>
        </input>
      </encoder>

      <!-- 10: Dictionary word - dictionary salt - salt not provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_word_generator"/>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>false</value>
        </input>
      </encoder>

      <!-- 11: Random password - dictionary salt - salt provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="password_generator"/>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>true</value>
        </input>
      </encoder>

      <!-- 12: Random password - dictionary salt - salt not provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="password_generator"/>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>false</value>
        </input>
      </encoder>

      <!-- 13: Number - unsalted-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_number_generator">
            <input into="maximum">
              <value>10000000</value>
            </input>
          </generator>
        </input>
      </encoder>

      <!-- 14: Dictionary word - numerical salt - salt provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_number_generator">
            <input into="maximum">
              <value>100</value>
            </input>
          </generator>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>true</value>
        </input>
      </encoder>

      <!-- 15: Dictionary word - numerical salt - salt not provided-->
      <encoder type="hash">
        <input into="strings_to_encode">
          <generator type="random_number_generator">
            <input into="maximum">
              <value>100</value>
            </input>
          </generator>
        </input>
        <input into="salt">
          <generator type="random_word_generator"/>
        </input>
        <input into="return_salts">
          <value>false</value>
        </input>
      </encoder>

    </input>

    <!-- Local challenges -->
    <utility module_path=".*parameterised_accounts">
      <input into="accounts" into_datastore="accounts">
        <generator type="account">
          <input into="username">
            <value>challenger</value>
          </input>
          <input into="password">
            <value>tiaspbiqe2r</value>
          </input>
          <input into="super_user">
            <value>true</value>
          </input>
          <input into="strings_to_leak">
            <value/>
          </input>
          <input into="leaked_filenames">
            <value/>
          </input>
          <input into="data_to_leak">
            <generator type="leaked_data">
              <input into="data">
                <datastore access="0">challenges</datastore>
              </input>
              <input into="filename">
                <value>cipher</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_01</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="1">challenges</datastore>
              </input>
              <input into="filename">
                <value>cipher</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_02</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="2">challenges</datastore>
              </input>
              <input into="filename">
                <value>cipher</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_03</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="3">challenges</datastore>
              </input>
              <input into="filename">
                <value>cipher</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_04</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="4">challenges</datastore>
              </input>
              <input into="filename">
                <value>cipher</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_05</value>
              </input>
            </generator>

            <!--6: random high difficulty encoder -->
            <encoder difficulty="high">
              <input into="strings_to_encode">
                <generator type="flag_generator"/>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_06</value>
              </input>
            </encoder>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="5">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_07</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="6">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_08</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="7">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_09</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="8">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_10</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="9">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_11</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="10">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_12</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="11">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_13</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="12">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_14</value>
              </input>
            </generator>

            <generator type="leaked_data">
              <input into="data">
                <datastore access="13">challenges</datastore>
              </input>
              <input into="filename">
                <value>hash</value>
              </input>
              <input into="subdirectory">
                <value>challenges/challenge_15</value>
              </input>
            </generator>

          </input>
        </generator>
      </input>
    </utility>

    <utility module_path=".*hashcat"/>
    <utility module_path=".*johntheripper"/>

    <utility module_path=".*kde_minimal">
      <input into="accounts">
        <datastore>accounts</datastore>
      </input>
      <input into="autostart_konsole">
        <value>true</value>
      </input>
      <input into="autologin_user">
        <datastore access="0" access_json="['username']">accounts</datastore>
      </input>
    </utility>

    <network type="private_network">
      <input into="IP_address">
        <datastore access="0">IP_addresses</datastore>
      </input>
    </network>

  </system>

</scenario>
